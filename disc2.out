2023-04-03 21:44:07,105 - root INFO - Main - acquire a child logger and then log messages in the child
2023-04-03 21:44:07,105 - DiscoveryAppln DEBUG - Main: parse command line arguments
2023-04-03 21:44:07,113 - DiscoveryAppln DEBUG - Main: resetting log level to 20
2023-04-03 21:44:07,113 - DiscoveryAppln INFO - DiscoveryAppln::configure
2023-04-03 21:44:07,113 - DiscoveryAppln INFO - DiscoveryMW::configure
2023-04-03 21:44:07,114 - DiscoveryAppln INFO - DiscoveryMW::ensure_quorum
2023-04-03 21:44:07,133 - kazoo.client INFO - Connecting to 10.0.0.1(10.0.0.1):2181, use_ssl: False
2023-04-03 21:44:07,136 - kazoo.client WARNING - Connection dropped: socket connection error: Connection refused
2023-04-03 21:44:07,259 - kazoo.client INFO - Connecting to 10.0.0.1(10.0.0.1):2181, use_ssl: False
2023-04-03 21:44:07,262 - kazoo.client WARNING - Connection dropped: socket connection error: Connection refused
2023-04-03 21:44:07,447 - kazoo.client INFO - Connecting to 10.0.0.1(10.0.0.1):2181, use_ssl: False
2023-04-03 21:44:07,449 - kazoo.client WARNING - Connection dropped: socket connection error: Connection refused
2023-04-03 21:44:07,702 - kazoo.client INFO - Connecting to 10.0.0.1(10.0.0.1):2181, use_ssl: False
2023-04-03 21:44:07,705 - kazoo.client WARNING - Connection dropped: socket connection error: Connection refused
2023-04-03 21:44:08,063 - kazoo.client INFO - Connecting to 10.0.0.1(10.0.0.1):2181, use_ssl: False
2023-04-03 21:44:08,065 - kazoo.client WARNING - Connection dropped: socket connection error: Connection refused
2023-04-03 21:44:08,625 - kazoo.client INFO - Connecting to 10.0.0.1(10.0.0.1):2181, use_ssl: False
2023-04-03 21:44:08,627 - kazoo.client DEBUG - Sending request(xid=None): Connect(protocol_version=0, last_zxid_seen=0, time_out=10000, session_id=0, passwd=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', read_only=None)
2023-04-03 21:44:08,670 - kazoo.client INFO - Zookeeper connection established, state: CONNECTED
2023-04-03 21:44:08,671 - DiscoveryAppln INFO - DiscoveryMW::ensure_quorum: ZK client state = CONNECTED
2023-04-03 21:44:08,671 - kazoo.client DEBUG - Sending request(xid=1): Create(path='/discovery/disc2', data=b'', acl=[ACL(perms=31, acl_list=['ALL'], id=Id(scheme='world', id='anyone'))], flags=1)
2023-04-03 21:44:08,685 - kazoo.client DEBUG - Received error(xid=1) NoNodeError()
2023-04-03 21:44:08,686 - kazoo.client DEBUG - Sending request(xid=2): Exists(path='/discovery', watcher=None)
2023-04-03 21:44:08,703 - kazoo.client DEBUG - Sending request(xid=3): Exists(path='/', watcher=None)
2023-04-03 21:44:08,711 - kazoo.client DEBUG - Received response(xid=3): ZnodeStat(czxid=0, mzxid=0, ctime=0, mtime=0, version=0, cversion=-1, aversion=0, ephemeralOwner=0, dataLength=0, numChildren=1, pzxid=0)
2023-04-03 21:44:08,716 - kazoo.client DEBUG - Sending request(xid=4): Create(path='/discovery', data=b'', acl=[ACL(perms=31, acl_list=['ALL'], id=Id(scheme='world', id='anyone'))], flags=0)
2023-04-03 21:44:08,747 - kazoo.client DEBUG - Received response(xid=4): '/discovery'
2023-04-03 21:44:08,748 - kazoo.client DEBUG - Sending request(xid=5): Create(path='/discovery/disc2', data=b'', acl=[ACL(perms=31, acl_list=['ALL'], id=Id(scheme='world', id='anyone'))], flags=1)
2023-04-03 21:44:08,754 - kazoo.client DEBUG - Received response(xid=5): '/discovery/disc2'
2023-04-03 21:44:08,759 - kazoo.client DEBUG - Sending request(xid=6): GetChildren(path='/discovery', watcher=None)
2023-04-03 21:44:08,776 - kazoo.client DEBUG - Received response(xid=6): ['disc2']
2023-04-03 21:44:08,777 - DiscoveryAppln INFO - DiscoveryMW::ensure_quorum: quorum_size not met, waiting for 2s
2023-04-03 21:44:10,780 - kazoo.client DEBUG - Sending request(xid=7): GetChildren(path='/discovery', watcher=None)
2023-04-03 21:44:10,782 - kazoo.client DEBUG - Received response(xid=7): ['disc3', 'disc1', 'disc2']
2023-04-03 21:44:10,782 - DiscoveryAppln INFO - DiscoveryMW::ensure_quorum: quorum_size met, creating leader
2023-04-03 21:44:10,782 - DiscoveryAppln INFO - DiscoveryMW::create_leader: attempting to create new ephemeral leader
2023-04-03 21:44:10,782 - kazoo.client DEBUG - Sending request(xid=8): Create(path='/leader', data=b'{"name": "disc2", "rep_addr": "tcp://10.0.0.3:5555", "pub_addr": "tcp://10.0.0.3:5556"}', acl=[ACL(perms=31, acl_list=['ALL'], id=Id(scheme='world', id='anyone'))], flags=1)
2023-04-03 21:44:10,785 - kazoo.client DEBUG - Received error(xid=8) NodeExistsError()
2023-04-03 21:44:10,785 - DiscoveryAppln INFO - DiscoveryMW::create_leader: leader already exists, connecting to leader through SUB socket
2023-04-03 21:44:10,785 - kazoo.client DEBUG - Sending request(xid=9): GetData(path='/leader', watcher=None)
2023-04-03 21:44:10,787 - kazoo.client DEBUG - Received response(xid=9): (b'{"name": "disc3", "rep_addr": "tcp://10.0.0.4:5555", "pub_addr": "tcp://10.0.0.4:5556"}', ZnodeStat(czxid=12, mzxid=12, ctime=1680576249877, mtime=1680576249877, version=0, cversion=0, aversion=0, ephemeralOwner=72058456050696197, dataLength=87, numChildren=0, pzxid=12))
2023-04-03 21:44:10,787 - DiscoveryAppln INFO - DiscoveryMW::create_leader: leader address = tcp://10.0.0.4:5556
2023-04-03 21:44:10,787 - kazoo.client DEBUG - Sending request(xid=10): GetData(path='/leader', watcher=<bound method DataWatch._watcher of <kazoo.recipe.watchers.DataWatch object at 0x7fe464cd0cd0>>)
2023-04-03 21:44:10,790 - kazoo.client DEBUG - Received response(xid=10): (b'{"name": "disc3", "rep_addr": "tcp://10.0.0.4:5555", "pub_addr": "tcp://10.0.0.4:5556"}', ZnodeStat(czxid=12, mzxid=12, ctime=1680576249877, mtime=1680576249877, version=0, cversion=0, aversion=0, ephemeralOwner=72058456050696197, dataLength=87, numChildren=0, pzxid=12))
2023-04-03 21:44:10,790 - kazoo.client DEBUG - Sending request(xid=11): GetData(path='/broker', watcher=<bound method DataWatch._watcher of <kazoo.recipe.watchers.DataWatch object at 0x7fe464cd1540>>)
2023-04-03 21:44:10,791 - kazoo.client DEBUG - Received error(xid=11) NoNodeError()
2023-04-03 21:44:10,791 - kazoo.client DEBUG - Sending request(xid=12): Exists(path='/broker', watcher=<bound method DataWatch._watcher of <kazoo.recipe.watchers.DataWatch object at 0x7fe464cd1540>>)
2023-04-03 21:44:10,793 - kazoo.client DEBUG - Sending request(xid=13): GetChildren(path='/publisher', watcher=<bound method ChildrenWatch._watcher of <kazoo.recipe.watchers.ChildrenWatch object at 0x7fe464cd1630>>)
2023-04-03 21:44:10,794 - kazoo.client DEBUG - Received response(xid=13): ['pub5', 'pub6']
2023-04-03 21:44:10,794 - DiscoveryAppln INFO - DiscoveryMW::watch_pubs: publisher changed, updating publisher info
2023-04-03 21:44:10,795 - kazoo.client DEBUG - Sending request(xid=14): GetData(path='/publisher/pub5', watcher=None)
2023-04-03 21:44:10,795 - kazoo.client DEBUG - Received response(xid=14): (b'{"id": {"id": "pub5", "addr": "10.0.0.5", "port": 5577}, "topiclist": ["location", "temperature", "airquality", "altitude", "weather"]}', ZnodeStat(czxid=15, mzxid=15, ctime=1680576249999, mtime=1680576249999, version=0, cversion=0, aversion=0, ephemeralOwner=72058456050696194, dataLength=135, numChildren=0, pzxid=15))
2023-04-03 21:44:10,796 - kazoo.client DEBUG - Sending request(xid=15): GetData(path='/publisher/pub6', watcher=None)
2023-04-03 21:44:10,797 - kazoo.client DEBUG - Received response(xid=15): (b'{"id": {"id": "pub6", "addr": "10.0.0.6", "port": 5577}, "topiclist": ["weather", "light", "altitude", "humidity", "sound"]}', ZnodeStat(czxid=16, mzxid=16, ctime=1680576250693, mtime=1680576250693, version=0, cversion=0, aversion=0, ephemeralOwner=72058456050696196, dataLength=124, numChildren=0, pzxid=16))
2023-04-03 21:44:10,798 - DiscoveryAppln INFO - DiscoveryMW::configure completed
2023-04-03 21:44:10,798 - DiscoveryAppln INFO - DiscoveryAppln::configure completed
2023-04-03 21:44:10,798 - DiscoveryAppln INFO - DiscoveryAppln::driver
2023-04-03 21:44:10,798 - DiscoveryAppln INFO - **********************************
2023-04-03 21:44:10,798 - DiscoveryAppln INFO - DiscoveryAppln::dump
2023-04-03 21:44:10,798 - DiscoveryAppln INFO - ------------------------------
2023-04-03 21:44:10,798 - DiscoveryAppln INFO -      Lookup: Centralized
2023-04-03 21:44:10,799 - DiscoveryAppln INFO -      Dissemination: Direct
2023-04-03 21:44:10,799 - DiscoveryAppln INFO - **********************************
2023-04-03 21:44:10,799 - DiscoveryAppln INFO - DiscoveryMW::event_loop: start
2023-04-03 21:44:10,799 - DiscoveryAppln INFO - DiscoveryAppln::invoke_operation
2023-04-03 21:44:10,813 - kazoo.client DEBUG - Received EVENT: Watch(type=4, state=3, path='/publisher')
2023-04-03 21:44:10,814 - kazoo.client DEBUG - Sending request(xid=16): GetChildren(path='/publisher', watcher=<bound method ChildrenWatch._watcher of <kazoo.recipe.watchers.ChildrenWatch object at 0x7fe464cd1630>>)
2023-04-03 21:44:10,815 - kazoo.client DEBUG - Received response(xid=16): ['pub5', 'pub6', 'pub7']
2023-04-03 21:44:10,815 - DiscoveryAppln INFO - DiscoveryMW::watch_pubs: publisher changed, updating publisher info
2023-04-03 21:44:10,815 - kazoo.client DEBUG - Sending request(xid=17): GetData(path='/publisher/pub5', watcher=None)
2023-04-03 21:44:10,818 - kazoo.client DEBUG - Received response(xid=17): (b'{"id": {"id": "pub5", "addr": "10.0.0.5", "port": 5577}, "topiclist": ["location", "temperature", "airquality", "altitude", "weather"]}', ZnodeStat(czxid=15, mzxid=15, ctime=1680576249999, mtime=1680576249999, version=0, cversion=0, aversion=0, ephemeralOwner=72058456050696194, dataLength=135, numChildren=0, pzxid=15))
2023-04-03 21:44:10,819 - kazoo.client DEBUG - Sending request(xid=18): GetData(path='/publisher/pub6', watcher=None)
2023-04-03 21:44:10,820 - kazoo.client DEBUG - Received response(xid=18): (b'{"id": {"id": "pub6", "addr": "10.0.0.6", "port": 5577}, "topiclist": ["weather", "light", "altitude", "humidity", "sound"]}', ZnodeStat(czxid=16, mzxid=16, ctime=1680576250693, mtime=1680576250693, version=0, cversion=0, aversion=0, ephemeralOwner=72058456050696196, dataLength=124, numChildren=0, pzxid=16))
2023-04-03 21:44:10,820 - kazoo.client DEBUG - Sending request(xid=19): GetData(path='/publisher/pub7', watcher=None)
2023-04-03 21:44:10,822 - kazoo.client DEBUG - Received response(xid=19): (b'{"id": {"id": "pub7", "addr": "10.0.0.7", "port": 5577}, "topiclist": ["pressure", "light", "temperature", "altitude", "humidity"]}', ZnodeStat(czxid=18, mzxid=18, ctime=1680576250810, mtime=1680576250810, version=0, cversion=0, aversion=0, ephemeralOwner=72058456050696193, dataLength=131, numChildren=0, pzxid=18))
2023-04-03 21:44:21,233 - kazoo.client DEBUG - Received EVENT: Watch(type=2, state=3, path='/leader')
2023-04-03 21:44:21,235 - kazoo.client DEBUG - Sending request(xid=20): GetData(path='/leader', watcher=<bound method DataWatch._watcher of <kazoo.recipe.watchers.DataWatch object at 0x7fe464cd0cd0>>)
2023-04-03 21:44:21,236 - kazoo.client DEBUG - Received error(xid=20) NoNodeError()
2023-04-03 21:44:21,236 - kazoo.client DEBUG - Sending request(xid=21): Exists(path='/leader', watcher=<bound method DataWatch._watcher of <kazoo.recipe.watchers.DataWatch object at 0x7fe464cd0cd0>>)
2023-04-03 21:44:21,238 - DiscoveryAppln INFO - DiscoveryMW::watch_leader: leader deleted, trying to create new leader
2023-04-03 21:44:21,238 - DiscoveryAppln INFO - DiscoveryMW::create_leader: attempting to create new ephemeral leader
2023-04-03 21:44:21,240 - kazoo.client DEBUG - Sending request(xid=22): Create(path='/leader', data=b'{"name": "disc2", "rep_addr": "tcp://10.0.0.3:5555", "pub_addr": "tcp://10.0.0.3:5556"}', acl=[ACL(perms=31, acl_list=['ALL'], id=Id(scheme='world', id='anyone'))], flags=1)
2023-04-03 21:44:21,243 - kazoo.client DEBUG - Received EVENT: Watch(type=1, state=3, path='/leader')
2023-04-03 21:44:21,247 - kazoo.client DEBUG - Received error(xid=22) NodeExistsError()
2023-04-03 21:44:21,247 - DiscoveryAppln INFO - DiscoveryMW::create_leader: leader already exists, connecting to leader through SUB socket
2023-04-03 21:44:21,247 - kazoo.client DEBUG - Sending request(xid=23): GetData(path='/leader', watcher=None)
2023-04-03 21:44:21,249 - kazoo.client DEBUG - Received response(xid=23): (b'{"name": "disc1", "rep_addr": "tcp://10.0.0.2:5555", "pub_addr": "tcp://10.0.0.2:5556"}', ZnodeStat(czxid=21, mzxid=21, ctime=1680576261240, mtime=1680576261240, version=0, cversion=0, aversion=0, ephemeralOwner=72058456050696195, dataLength=87, numChildren=0, pzxid=21))
2023-04-03 21:44:21,250 - DiscoveryAppln INFO - DiscoveryMW::create_leader: leader address = tcp://10.0.0.2:5556
2023-04-03 21:44:21,250 - kazoo.client DEBUG - Sending request(xid=24): GetData(path='/leader', watcher=<bound method DataWatch._watcher of <kazoo.recipe.watchers.DataWatch object at 0x7fe464cd0cd0>>)
2023-04-03 21:44:21,257 - kazoo.client DEBUG - Received response(xid=24): (b'{"name": "disc1", "rep_addr": "tcp://10.0.0.2:5555", "pub_addr": "tcp://10.0.0.2:5556"}', ZnodeStat(czxid=21, mzxid=21, ctime=1680576261240, mtime=1680576261240, version=0, cversion=0, aversion=0, ephemeralOwner=72058456050696195, dataLength=87, numChildren=0, pzxid=21))
