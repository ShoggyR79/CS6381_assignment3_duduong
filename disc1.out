2023-04-04 16:05:23,663 - root INFO - Main - acquire a child logger and then log messages in the child
2023-04-04 16:05:23,669 - DiscoveryAppln DEBUG - Main: parse command line arguments
2023-04-04 16:05:23,673 - DiscoveryAppln DEBUG - Main: resetting log level to 20
2023-04-04 16:05:23,673 - DiscoveryAppln INFO - DiscoveryAppln::configure
2023-04-04 16:05:23,674 - DiscoveryAppln INFO - DiscoveryMW::configure
2023-04-04 16:05:23,675 - DiscoveryAppln INFO - DiscoveryMW::ensure_quorum
2023-04-04 16:05:23,705 - kazoo.client INFO - Connecting to 10.0.0.1(10.0.0.1):2181, use_ssl: False
2023-04-04 16:05:23,711 - kazoo.client WARNING - Connection dropped: socket connection error: Connection refused
2023-04-04 16:05:23,776 - kazoo.client INFO - Connecting to 10.0.0.1(10.0.0.1):2181, use_ssl: False
2023-04-04 16:05:23,782 - kazoo.client WARNING - Connection dropped: socket connection error: Connection refused
2023-04-04 16:05:23,904 - kazoo.client INFO - Connecting to 10.0.0.1(10.0.0.1):2181, use_ssl: False
2023-04-04 16:05:23,905 - kazoo.client WARNING - Connection dropped: socket connection error: Connection refused
2023-04-04 16:05:24,222 - kazoo.client INFO - Connecting to 10.0.0.1(10.0.0.1):2181, use_ssl: False
2023-04-04 16:05:24,224 - kazoo.client WARNING - Connection dropped: socket connection error: Connection refused
2023-04-04 16:05:24,822 - kazoo.client INFO - Connecting to 10.0.0.1(10.0.0.1):2181, use_ssl: False
2023-04-04 16:05:24,824 - kazoo.client DEBUG - Sending request(xid=None): Connect(protocol_version=0, last_zxid_seen=0, time_out=10000, session_id=0, passwd=b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', read_only=None)
2023-04-04 16:05:24,827 - kazoo.client INFO - Zookeeper connection established, state: CONNECTED
2023-04-04 16:05:24,827 - DiscoveryAppln INFO - DiscoveryMW::ensure_quorum: ZK client state = CONNECTED
2023-04-04 16:05:24,828 - kazoo.client DEBUG - Sending request(xid=1): Create(path='/discovery/disc1', data=b'', acl=[ACL(perms=31, acl_list=['ALL'], id=Id(scheme='world', id='anyone'))], flags=1)
2023-04-04 16:05:24,832 - kazoo.client DEBUG - Received error(xid=1) NoNodeError()
2023-04-04 16:05:24,832 - kazoo.client DEBUG - Sending request(xid=2): Exists(path='/discovery', watcher=None)
2023-04-04 16:05:24,834 - kazoo.client DEBUG - Sending request(xid=3): Exists(path='/', watcher=None)
2023-04-04 16:05:24,835 - kazoo.client DEBUG - Received response(xid=3): ZnodeStat(czxid=0, mzxid=0, ctime=0, mtime=0, version=0, cversion=-1, aversion=0, ephemeralOwner=0, dataLength=0, numChildren=1, pzxid=0)
2023-04-04 16:05:24,836 - kazoo.client DEBUG - Sending request(xid=4): Create(path='/discovery', data=b'', acl=[ACL(perms=31, acl_list=['ALL'], id=Id(scheme='world', id='anyone'))], flags=0)
2023-04-04 16:05:24,843 - kazoo.client DEBUG - Received response(xid=4): '/discovery'
2023-04-04 16:05:24,843 - kazoo.client DEBUG - Sending request(xid=5): Create(path='/discovery/disc1', data=b'', acl=[ACL(perms=31, acl_list=['ALL'], id=Id(scheme='world', id='anyone'))], flags=1)
2023-04-04 16:05:24,845 - kazoo.client DEBUG - Received response(xid=5): '/discovery/disc1'
2023-04-04 16:05:24,846 - kazoo.client DEBUG - Sending request(xid=6): GetChildren(path='/discovery', watcher=None)
2023-04-04 16:05:24,848 - kazoo.client DEBUG - Received response(xid=6): ['disc1']
2023-04-04 16:05:24,848 - DiscoveryAppln INFO - DiscoveryMW::ensure_quorum: quorum_size not met, waiting for 2s
2023-04-04 16:05:26,851 - kazoo.client DEBUG - Sending request(xid=7): GetChildren(path='/discovery', watcher=None)
2023-04-04 16:05:26,853 - kazoo.client DEBUG - Received response(xid=7): ['disc3', 'disc1', 'disc2']
2023-04-04 16:05:26,853 - DiscoveryAppln INFO - DiscoveryMW::ensure_quorum: quorum_size met, creating leader
2023-04-04 16:05:26,853 - DiscoveryAppln INFO - DiscoveryMW::create_leader: attempting to create new ephemeral leader
2023-04-04 16:05:26,853 - kazoo.client DEBUG - Sending request(xid=8): Create(path='/leader', data=b'{"name": "disc1", "rep_addr": "tcp://10.0.0.2:5555", "pub_addr": "tcp://10.0.0.2:5556"}', acl=[ACL(perms=31, acl_list=['ALL'], id=Id(scheme='world', id='anyone'))], flags=1)
2023-04-04 16:05:26,855 - kazoo.client DEBUG - Received error(xid=8) NodeExistsError()
2023-04-04 16:05:26,856 - DiscoveryAppln INFO - DiscoveryMW::create_leader: leader already exists, connecting to leader through SUB socket
2023-04-04 16:05:26,856 - kazoo.client DEBUG - Sending request(xid=9): GetData(path='/leader', watcher=None)
2023-04-04 16:05:26,857 - kazoo.client DEBUG - Received response(xid=9): (b'{"name": "disc2", "rep_addr": "tcp://10.0.0.3:5555", "pub_addr": "tcp://10.0.0.3:5556"}', ZnodeStat(czxid=14, mzxid=14, ctime=1680642325037, mtime=1680642325037, version=0, cversion=0, aversion=0, ephemeralOwner=72059897973637127, dataLength=87, numChildren=0, pzxid=14))
2023-04-04 16:05:26,857 - DiscoveryAppln INFO - DiscoveryMW::create_leader: leader address = tcp://10.0.0.3:5556
2023-04-04 16:05:26,858 - DiscoveryAppln INFO - DiscoveryMW::configure completed
2023-04-04 16:05:26,858 - DiscoveryAppln INFO - DiscoveryAppln::configure completed
2023-04-04 16:05:26,858 - DiscoveryAppln INFO - DiscoveryAppln::driver
2023-04-04 16:05:26,858 - DiscoveryAppln INFO - **********************************
2023-04-04 16:05:26,858 - DiscoveryAppln INFO - DiscoveryAppln::dump
2023-04-04 16:05:26,858 - DiscoveryAppln INFO - ------------------------------
2023-04-04 16:05:26,858 - DiscoveryAppln INFO -      Lookup: Centralized
2023-04-04 16:05:26,858 - DiscoveryAppln INFO -      Dissemination: Broker
2023-04-04 16:05:26,858 - DiscoveryAppln INFO - **********************************
2023-04-04 16:05:26,858 - kazoo.client DEBUG - Sending request(xid=10): GetData(path='/leader', watcher=<bound method DataWatch._watcher of <kazoo.recipe.watchers.DataWatch object at 0x7f634b975870>>)
2023-04-04 16:05:26,860 - kazoo.client DEBUG - Received response(xid=10): (b'{"name": "disc2", "rep_addr": "tcp://10.0.0.3:5555", "pub_addr": "tcp://10.0.0.3:5556"}', ZnodeStat(czxid=14, mzxid=14, ctime=1680642325037, mtime=1680642325037, version=0, cversion=0, aversion=0, ephemeralOwner=72059897973637127, dataLength=87, numChildren=0, pzxid=14))
2023-04-04 16:05:26,860 - kazoo.client DEBUG - Sending request(xid=11): GetData(path='/broker', watcher=<bound method DataWatch._watcher of <kazoo.recipe.watchers.DataWatch object at 0x7f634b975930>>)
2023-04-04 16:05:26,861 - kazoo.client DEBUG - Received response(xid=11): (b'{"id": "broker1", "addr": "10.0.0.11", "port": 7777}', ZnodeStat(czxid=18, mzxid=18, ctime=1680642325569, mtime=1680642325569, version=0, cversion=0, aversion=0, ephemeralOwner=72059897973637129, dataLength=52, numChildren=0, pzxid=18))
2023-04-04 16:05:26,862 - DiscoveryAppln INFO - DiscoveryMW::watch_broker: broker changed, updating broker info
2023-04-04 16:05:26,862 - kazoo.client DEBUG - Sending request(xid=12): GetData(path='/broker', watcher=None)
2023-04-04 16:05:26,863 - kazoo.client DEBUG - Received response(xid=12): (b'{"id": "broker1", "addr": "10.0.0.11", "port": 7777}', ZnodeStat(czxid=18, mzxid=18, ctime=1680642325569, mtime=1680642325569, version=0, cversion=0, aversion=0, ephemeralOwner=72059897973637129, dataLength=52, numChildren=0, pzxid=18))
2023-04-04 16:05:26,863 - DiscoveryAppln INFO - DiscoveryMW::watch_broker: {'id': 'broker1', 'addr': '10.0.0.11', 'port': 7777}
2023-04-04 16:05:26,863 - DiscoveryAppln INFO - DiscoveryAppln::update_broker_info - updating broker to {'id': 'broker1', 'addr': '10.0.0.11', 'port': 7777}
2023-04-04 16:05:26,863 - kazoo.client DEBUG - Sending request(xid=13): Create(path='/publisher', data=b'', acl=[ACL(perms=31, acl_list=['ALL'], id=Id(scheme='world', id='anyone'))], flags=0)
2023-04-04 16:05:26,865 - kazoo.client DEBUG - Received error(xid=13) NodeExistsError()
2023-04-04 16:05:26,866 - kazoo.client DEBUG - Sending request(xid=14): GetChildren(path='/publisher', watcher=<bound method ChildrenWatch._watcher of <kazoo.recipe.watchers.ChildrenWatch object at 0x7f634b975600>>)
2023-04-04 16:05:26,867 - kazoo.client DEBUG - Received response(xid=14): ['pub5', 'pub6', 'pub7']
2023-04-04 16:05:26,867 - DiscoveryAppln INFO - DiscoveryMW::watch_pubs: publisher changed, updating publisher info
2023-04-04 16:05:26,867 - kazoo.client DEBUG - Sending request(xid=15): GetData(path='/publisher/pub5', watcher=None)
2023-04-04 16:05:26,868 - kazoo.client DEBUG - Received response(xid=15): (b'{"id": {"id": "pub5", "addr": "10.0.0.5", "port": 5577}, "topiclist": ["sound", "weather", "light", "altitude", "airquality"]}', ZnodeStat(czxid=20, mzxid=20, ctime=1680642325837, mtime=1680642325837, version=0, cversion=0, aversion=0, ephemeralOwner=72059897973637121, dataLength=126, numChildren=0, pzxid=20))
2023-04-04 16:05:26,868 - kazoo.client DEBUG - Sending request(xid=16): GetData(path='/publisher/pub6', watcher=None)
2023-04-04 16:05:26,869 - kazoo.client DEBUG - Received response(xid=16): (b'{"id": {"id": "pub6", "addr": "10.0.0.6", "port": 5577}, "topiclist": ["altitude", "temperature", "humidity", "pressure", "weather"]}', ZnodeStat(czxid=19, mzxid=19, ctime=1680642325828, mtime=1680642325828, version=0, cversion=0, aversion=0, ephemeralOwner=72059897973637120, dataLength=133, numChildren=0, pzxid=19))
2023-04-04 16:05:26,869 - kazoo.client DEBUG - Sending request(xid=17): GetData(path='/publisher/pub7', watcher=None)
2023-04-04 16:05:26,870 - kazoo.client DEBUG - Received response(xid=17): (b'{"id": {"id": "pub7", "addr": "10.0.0.7", "port": 5577}, "topiclist": ["altitude", "pressure", "sound", "humidity", "temperature"]}', ZnodeStat(czxid=21, mzxid=21, ctime=1680642325976, mtime=1680642325976, version=0, cversion=0, aversion=0, ephemeralOwner=72059897973637125, dataLength=131, numChildren=0, pzxid=21))
2023-04-04 16:05:26,870 - DiscoveryAppln INFO - DiscoveryMW::watch_pubs: [{'id': {'id': 'pub5', 'addr': '10.0.0.5', 'port': 5577}, 'topiclist': ['sound', 'weather', 'light', 'altitude', 'airquality']}, {'id': {'id': 'pub6', 'addr': '10.0.0.6', 'port': 5577}, 'topiclist': ['altitude', 'temperature', 'humidity', 'pressure', 'weather']}, {'id': {'id': 'pub7', 'addr': '10.0.0.7', 'port': 5577}, 'topiclist': ['altitude', 'pressure', 'sound', 'humidity', 'temperature']}]
2023-04-04 16:05:26,870 - DiscoveryAppln INFO - DiscoveryAppln::update_publisher_info - updating publishers
2023-04-04 16:05:26,870 - DiscoveryAppln INFO - DiscoveryAppln::update_publisher_info - updated publishers: {'pub5': {'id': 'pub5', 'addr': '10.0.0.5', 'port': 5577}, 'pub6': {'id': 'pub6', 'addr': '10.0.0.6', 'port': 5577}, 'pub7': {'id': 'pub7', 'addr': '10.0.0.7', 'port': 5577}}
2023-04-04 16:05:26,870 - DiscoveryAppln INFO - DiscoveryAppln::update_publisher_info - updated topics: {'sound': ['pub5', 'pub7'], 'weather': ['pub5', 'pub6'], 'light': ['pub5'], 'altitude': ['pub5', 'pub6', 'pub7'], 'airquality': ['pub5'], 'temperature': ['pub6', 'pub7'], 'humidity': ['pub6', 'pub7'], 'pressure': ['pub6', 'pub7']}
2023-04-04 16:05:26,870 - DiscoveryAppln INFO - DiscoveryMW::event_loop: start
2023-04-04 16:05:26,870 - DiscoveryAppln INFO - DiscoveryAppln::invoke_operation
2023-04-04 16:05:35,341 - kazoo.client DEBUG - Received EVENT: Watch(type=2, state=3, path='/leader')
2023-04-04 16:05:35,343 - kazoo.client DEBUG - Sending request(xid=18): GetData(path='/leader', watcher=<bound method DataWatch._watcher of <kazoo.recipe.watchers.DataWatch object at 0x7f634b975870>>)
2023-04-04 16:05:35,345 - kazoo.client DEBUG - Received error(xid=18) NoNodeError()
2023-04-04 16:05:35,345 - kazoo.client DEBUG - Sending request(xid=19): Exists(path='/leader', watcher=<bound method DataWatch._watcher of <kazoo.recipe.watchers.DataWatch object at 0x7f634b975870>>)
2023-04-04 16:05:35,347 - DiscoveryAppln INFO - DiscoveryMW::watch_leader: leader deleted, trying to create new leader
2023-04-04 16:05:35,348 - DiscoveryAppln INFO - DiscoveryMW::create_leader: attempting to create new ephemeral leader
2023-04-04 16:05:35,348 - kazoo.client DEBUG - Sending request(xid=20): Create(path='/leader', data=b'{"name": "disc1", "rep_addr": "tcp://10.0.0.2:5555", "pub_addr": "tcp://10.0.0.2:5556"}', acl=[ACL(perms=31, acl_list=['ALL'], id=Id(scheme='world', id='anyone'))], flags=1)
2023-04-04 16:05:35,350 - kazoo.client DEBUG - Received EVENT: Watch(type=1, state=3, path='/leader')
2023-04-04 16:05:35,353 - kazoo.client DEBUG - Received error(xid=20) NodeExistsError()
2023-04-04 16:05:35,354 - DiscoveryAppln INFO - DiscoveryMW::create_leader: leader already exists, connecting to leader through SUB socket
2023-04-04 16:05:35,355 - kazoo.client DEBUG - Sending request(xid=21): GetData(path='/leader', watcher=None)
2023-04-04 16:05:35,356 - kazoo.client DEBUG - Received response(xid=21): (b'{"name": "disc3", "rep_addr": "tcp://10.0.0.4:5555", "pub_addr": "tcp://10.0.0.4:5556"}', ZnodeStat(czxid=28, mzxid=28, ctime=1680642335348, mtime=1680642335348, version=0, cversion=0, aversion=0, ephemeralOwner=72059897973637124, dataLength=87, numChildren=0, pzxid=28))
2023-04-04 16:05:35,357 - DiscoveryAppln INFO - DiscoveryMW::create_leader: leader address = tcp://10.0.0.4:5556
2023-04-04 16:05:35,357 - kazoo.client DEBUG - Sending request(xid=22): GetData(path='/leader', watcher=<bound method DataWatch._watcher of <kazoo.recipe.watchers.DataWatch object at 0x7f634b975870>>)
2023-04-04 16:05:35,362 - kazoo.client DEBUG - Received response(xid=22): (b'{"name": "disc3", "rep_addr": "tcp://10.0.0.4:5555", "pub_addr": "tcp://10.0.0.4:5556"}', ZnodeStat(czxid=28, mzxid=28, ctime=1680642335348, mtime=1680642335348, version=0, cversion=0, aversion=0, ephemeralOwner=72059897973637124, dataLength=87, numChildren=0, pzxid=28))
